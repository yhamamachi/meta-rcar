From 1d49674b17473bf72cf092f31c1dbaa13fe157a6 Mon Sep 17 00:00:00 2001
From: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
Date: Wed, 28 Oct 2020 17:24:07 +0300
Subject: [PATCH] media: v4l2-async: workaround for RCAR VIN

This is a workaround for RCAR VIN drivers that use single media
device registration (notification complete) for all 8 VINs, but
This must be separated to VINs[0-3] and VINs[4-7] since these are
fully independents.
Currently if we have all 8 VIN enabled then any of quad VINs group
affect another one, i.e. if first groupd fail then sencond group fails
too due to miss of notification complete.
Normally the RCAR VIN must be reworked to separate 8 VINs into 2 independent
groups during registration.

Signed-off-by: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
---
 drivers/media/v4l2-core/v4l2-async.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/media/v4l2-core/v4l2-async.c b/drivers/media/v4l2-core/v4l2-async.c
index 8bde33c..909c910 100644
--- a/drivers/media/v4l2-core/v4l2-async.c
+++ b/drivers/media/v4l2-core/v4l2-async.c
@@ -201,9 +201,11 @@ v4l2_async_notifier_can_complete(struct v4l2_async_notifier *notifier)
 static int
 v4l2_async_notifier_try_complete(struct v4l2_async_notifier *notifier)
 {
+#if 0
 	/* Quick check whether there are still more sub-devices here. */
 	if (!list_empty(&notifier->waiting))
 		return 0;
+#endif
 
 	/* Check the entire notifier tree; find the root notifier first. */
 	while (notifier->parent)
-- 
2.7.4

